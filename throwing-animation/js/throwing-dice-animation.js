THREE.Animation=function(b,f){this.root=b;this.data=THREE.AnimationHandler.init(f);this.hierarchy=THREE.AnimationHandler.parse(b);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.loop=!0;this.weight=0;this.interpolationType=THREE.AnimationHandler.LINEAR};
THREE.Animation.prototype={constructor:THREE.Animation,keyTypes:["pos","rot","scl"],play:function(b,f){this.currentTime=void 0!==b?b:0;this.weight=void 0!==f?f:1;this.isPlaying=!0;this.reset();THREE.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1;THREE.AnimationHandler.stop(this)},reset:function(){for(var b=0,f=this.hierarchy.length;b<f;b++){var e=this.hierarchy[b];void 0===e.animationCache&&(e.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}});
var g=this.data.name,h=e.animationCache.animations,r=h[g];void 0===r&&(r={prevKey:{pos:0,rot:0,scl:0},nextKey:{pos:0,rot:0,scl:0},originalMatrix:e.matrix},h[g]=r);for(e=0;3>e;e++){for(var g=this.keyTypes[e],h=this.data.hierarchy[b].keys[0],p=this.getNextKeyWith(g,b,1);p.time<this.currentTime&&p.index>h.index;)h=p,p=this.getNextKeyWith(g,b,p.index+1);r.prevKey[g]=h;r.nextKey[g]=p}}},resetBlendWeights:function(){for(var b=0,f=this.hierarchy.length;b<f;b++){var e=this.hierarchy[b].animationCache;void 0!==
e&&(e=e.blending,e.positionWeight=0,e.quaternionWeight=0,e.scaleWeight=0)}},update:function(){var b=[],f=new THREE.Vector3,e=new THREE.Vector3,g=new THREE.Quaternion,h=function(b,e){var f=[],g=[],h,y,t,v,z,u;h=(b.length-1)*e;y=Math.floor(h);h-=y;f[0]=0===y?y:y-1;f[1]=y;f[2]=y>b.length-2?y:y+1;f[3]=y>b.length-3?y:y+2;y=b[f[0]];v=b[f[1]];z=b[f[2]];u=b[f[3]];f=h*h;t=h*f;g[0]=r(y[0],v[0],z[0],u[0],h,f,t);g[1]=r(y[1],v[1],z[1],u[1],h,f,t);g[2]=r(y[2],v[2],z[2],u[2],h,f,t);return g},r=function(b,e,f,g,
h,r,t){b=.5*(f-b);g=.5*(g-e);return(2*(e-f)+b+g)*t+(-3*(e-f)-2*b-g)*r+b*h+e};return function(p){if(!1!==this.isPlaying&&(this.currentTime+=p*this.timeScale,0!==this.weight)){p=this.data.length;if(this.currentTime>p||0>this.currentTime)this.loop?(this.currentTime%=p,0>this.currentTime&&(this.currentTime+=p),this.reset()):this.stop();p=0;for(var r=this.hierarchy.length;p<r;p++)for(var B=this.hierarchy[p],K=B.animationCache.animations[this.data.name],C=B.animationCache.blending,y=0;3>y;y++){var t=this.keyTypes[y],
v=K.prevKey[t],z=K.nextKey[t];if(0<this.timeScale&&z.time<=this.currentTime||0>this.timeScale&&v.time>=this.currentTime){v=this.data.hierarchy[p].keys[0];for(z=this.getNextKeyWith(t,p,1);z.time<this.currentTime&&z.index>v.index;)v=z,z=this.getNextKeyWith(t,p,z.index+1);K.prevKey[t]=v;K.nextKey[t]=z}var u=(this.currentTime-v.time)/(z.time-v.time),x=v[t],F=z[t];0>u&&(u=0);1<u&&(u=1);if("pos"===t)if(this.interpolationType===THREE.AnimationHandler.LINEAR)e.x=x[0]+(F[0]-x[0])*u,e.y=x[1]+(F[1]-x[1])*u,
e.z=x[2]+(F[2]-x[2])*u,v=this.weight/(this.weight+C.positionWeight),B.position.lerp(e,v),C.positionWeight+=this.weight;else{if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)b[0]=this.getPrevKeyWith("pos",p,v.index-1).pos,b[1]=x,b[2]=F,b[3]=this.getNextKeyWith("pos",p,z.index+1).pos,u=.33*u+.33,z=h(b,u),v=this.weight/(this.weight+C.positionWeight),C.positionWeight+=this.weight,t=B.position,t.x+=(z[0]-t.x)*v,t.y+=(z[1]-
t.y)*v,t.z+=(z[2]-t.z)*v,this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD&&(u=h(b,1.01*u),f.set(u[0],u[1],u[2]),f.sub(t),f.y=0,f.normalize(),B.rotation.set(0,Math.atan2(f.x,f.z),0))}else"rot"===t?(THREE.Quaternion.slerp(x,F,g,u),0===C.quaternionWeight?(B.quaternion.copy(g),C.quaternionWeight=this.weight):(v=this.weight/(this.weight+C.quaternionWeight),THREE.Quaternion.slerp(B.quaternion,g,B.quaternion,v),C.quaternionWeight+=this.weight)):"scl"===t&&(e.x=x[0]+(F[0]-x[0])*u,e.y=x[1]+
(F[1]-x[1])*u,e.z=x[2]+(F[2]-x[2])*u,v=this.weight/(this.weight+C.scaleWeight),B.scale.lerp(e,v),C.scaleWeight+=this.weight)}return!0}}}(),getNextKeyWith:function(b,f,e){var g=this.data.hierarchy[f].keys;for(e=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?e<g.length-1?e:g.length-1:e%g.length;e<g.length;e++)if(void 0!==g[e][b])return g[e];return this.data.hierarchy[f].keys[0]},getPrevKeyWith:function(b,f,e){var g=this.data.hierarchy[f].keys;
for(e=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?0<e?e:0:0<=e?e:e+g.length;0<=e;e--)if(void 0!==g[e][b])return g[e];return this.data.hierarchy[f].keys[g.length-1]}};THREE.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){console.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){console.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){console.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(b){if(!0===b.initialized)return b;for(var f=0;f<b.hierarchy.length;f++){for(var e=0;e<b.hierarchy[f].keys.length;e++)if(0>b.hierarchy[f].keys[e].time&&(b.hierarchy[f].keys[e].time=
0),void 0!==b.hierarchy[f].keys[e].rot&&!(b.hierarchy[f].keys[e].rot instanceof THREE.Quaternion)){var g=b.hierarchy[f].keys[e].rot;b.hierarchy[f].keys[e].rot=(new THREE.Quaternion).fromArray(g)}if(b.hierarchy[f].keys.length&&void 0!==b.hierarchy[f].keys[0].morphTargets){g={};for(e=0;e<b.hierarchy[f].keys.length;e++)for(var h=0;h<b.hierarchy[f].keys[e].morphTargets.length;h++){var r=b.hierarchy[f].keys[e].morphTargets[h];g[r]=-1}b.hierarchy[f].usedMorphTargets=g;for(e=0;e<b.hierarchy[f].keys.length;e++){var p=
{};for(r in g){for(h=0;h<b.hierarchy[f].keys[e].morphTargets.length;h++)if(b.hierarchy[f].keys[e].morphTargets[h]===r){p[r]=b.hierarchy[f].keys[e].morphTargetsInfluences[h];break}h===b.hierarchy[f].keys[e].morphTargets.length&&(p[r]=0)}b.hierarchy[f].keys[e].morphTargetsInfluences=p}}for(e=1;e<b.hierarchy[f].keys.length;e++)b.hierarchy[f].keys[e].time===b.hierarchy[f].keys[e-1].time&&(b.hierarchy[f].keys.splice(e,1),e--);for(e=0;e<b.hierarchy[f].keys.length;e++)b.hierarchy[f].keys[e].index=e}b.initialized=
!0;return b},parse:function(b){var f=function(b,e){e.push(b);for(var g=0;g<b.children.length;g++)f(b.children[g],e)},e=[];if(b instanceof THREE.SkinnedMesh)for(var g=0;g<b.skeleton.bones.length;g++)e.push(b.skeleton.bones[g]);else f(b,e);return e},play:function(b){-1===this.animations.indexOf(b)&&this.animations.push(b)},stop:function(b){b=this.animations.indexOf(b);-1!==b&&this.animations.splice(b,1)},update:function(b){for(var f=0;f<this.animations.length;f++)this.animations[f].resetBlendWeights();
for(f=0;f<this.animations.length;f++)this.animations[f].update(b)}};THREE.KeyFrameAnimation=function(b){this.root=b.node;this.data=THREE.AnimationHandler.init(b);this.hierarchy=THREE.AnimationHandler.parse(this.root);this.currentTime=0;this.timeScale=.001;this.isPlaying=!1;this.loop=this.isPaused=!0;b=0;for(var f=this.hierarchy.length;b<f;b++){var e=this.data.hierarchy[b].sids,g=this.hierarchy[b];if(this.data.hierarchy[b].keys.length&&e){for(var h=0;h<e.length;h++){var r=e[h],p=this.getNextKeyWith(r,b,0);p&&p.apply(r)}g.matrixAutoUpdate=!1;this.data.hierarchy[b].node.updateMatrix();
g.matrixWorldNeedsUpdate=!0}}};
THREE.KeyFrameAnimation.prototype={constructor:THREE.KeyFrameAnimation,play:function(b){this.currentTime=void 0!==b?b:0;if(!1===this.isPlaying){this.isPlaying=!0;var f=this.hierarchy.length,e,g;for(b=0;b<f;b++)e=this.hierarchy[b],g=this.data.hierarchy[b],void 0===g.animationCache&&(g.animationCache={},g.animationCache.prevKey=null,g.animationCache.nextKey=null,g.animationCache.originalMatrix=e.matrix),e=this.data.hierarchy[b].keys,1<e.length&&(g.animationCache.prevKey=e[0],g.animationCache.nextKey=
e[1],this.startTime=Math.min(e[0].time,this.startTime),this.endTime=Math.max(e[e.length-1].time,this.endTime));this.update(0)}this.isPaused=!1},stop:function(){this.isPaused=this.isPlaying=!1;for(var b=0;b<this.data.hierarchy.length;b++){var f=this.hierarchy[b],e=this.data.hierarchy[b];if(void 0!==e.animationCache){var g=e.animationCache.originalMatrix;g.copy(f.matrix);f.matrix=g;delete e.animationCache}}},update:function(b){if(!1!==this.isPlaying){this.currentTime+=b*this.timeScale;b=this.data.length;
!0===this.loop&&this.currentTime>b&&(this.currentTime%=b);this.currentTime=Math.min(this.currentTime,b);b=0;for(var f=this.hierarchy.length;b<f;b++){var e=this.hierarchy[b],g=this.data.hierarchy[b],h=g.keys,g=g.animationCache;if(h.length){var r=g.prevKey,p=g.nextKey;if(p.time<=this.currentTime){for(;p.time<this.currentTime&&p.index>r.index;)r=p,p=h[r.index+1];g.prevKey=r;g.nextKey=p}p.time>=this.currentTime?r.interpolate(p,this.currentTime):r.interpolate(p,p.time);this.data.hierarchy[b].node.updateMatrix();
e.matrixWorldNeedsUpdate=!0}}}},getNextKeyWith:function(b,f,e){f=this.data.hierarchy[f].keys;for(e%=f.length;e<f.length;e++)if(f[e].hasTarget(b))return f[e];return f[0]},getPrevKeyWith:function(b,f,e){f=this.data.hierarchy[f].keys;for(e=0<=e?e:e+f.length;0<=e;e--)if(f[e].hasTarget(b))return f[e];return f[f.length-1]}};THREE.ColladaLoader=function(){function b(a,d,c){L=(new DOMParser).parseFromString(a,"text/xml");d=d||Da;void 0!==c&&(a=c.split("/"),a.pop(),Ea=(1>a.length?".":a.join("/"))+"/");if((a=L.querySelectorAll("asset")[0])&&a.childNodes)for(c=0;c<a.childNodes.length;c++){var m=a.childNodes[c];switch(m.nodeName){case "unit":(m=m.getAttribute("meter"))&&(Fa=parseFloat(m));break;case "up_axis":Z=m.textContent.charAt(0)}}if(!0!==D.convertUpAxis||Z===D.upAxis)G=null;else switch(Z){case "X":G="Y"===D.upAxis?"XtoY":
"XtoZ";break;case "Y":G="X"===D.upAxis?"YtoX":"YtoZ";break;case "Z":G="X"===D.upAxis?"ZtoX":"ZtoY"}fa=f("library_images image",K,"image");oa=f("library_materials material",Ga,"material");pa=f("library_effects effect",M,"effect");N=f("library_geometries geometry",Ha,"geometry");qa=f("library_cameras camera",ra,"camera");sa=f("library_lights light",ga,"light");Q=f("library_controllers controller",C,"controller");T=f("library_animations animation",ta,"animation");ua=f("library_visual_scenes visual_scene",
v,"visual_scene");va=f("library_kinematics_models kinematics_model",wa,"kinematics_model");ha=[];ia=[];(a=L.querySelectorAll("scene instance_visual_scene")[0])?(a=a.getAttribute("url").replace(/^#/,""),H=ua[0<a.length?a:"visual_scene0"]):H=null;U=new THREE.Group;for(a=0;a<H.nodes.length;a++)U.add(B(H.nodes[a]));U.scale.multiplyScalar(Fa);xa=[];e(U);(a=L.querySelectorAll("instance_kinematics_model")[0])?(a=a.getAttribute("url").replace(/^#/,""),O=va[0<a.length?a:"kinematics_model0"]):O=null;ea();a=
{scene:U,morphs:ha,skins:ia,animations:xa,kinematics:ya,dae:{images:fa,materials:oa,cameras:qa,lights:sa,effects:pa,geometries:N,controllers:Q,animations:T,visualScenes:ua,visualScene:H,scene:H,kinematicsModels:va,kinematicsModel:O}};d&&d(a);return a}function f(a,d,c){a=L.querySelectorAll(a);for(var m={},b=0,q=a.length,e=0;e<q;e++){var f=a[e],f=(new d).parse(f);f.id&&0!==f.id.length||(f.id=c+b++);m[f.id]=f}return m}function e(a){var d=H.getChildById(a.colladaId,!0),c;if(d&&d.keys){c={fps:60,hierarchy:[{node:d,
keys:d.keys,sids:d.sids}],node:a,name:"animation_"+a.name,length:0};xa.push(c);for(var m=0,b=d.keys.length;m<b;m++)c.length=Math.max(c.length,d.keys[m].time)}else c={hierarchy:[{keys:[],sids:[]}]};m=0;for(b=a.children.length;m<b;m++)for(var d=0,q=e(a.children[m]).hierarchy.length;d<q;d++)c.hierarchy.push({keys:[],sids:[]});return c}function g(a,d,c,m){a.world=a.world||new THREE.Matrix4;a.localworld=a.localworld||new THREE.Matrix4;a.world.copy(a.matrix);a.localworld.copy(a.matrix);if(a.channels&&a.channels.length){var b=
a.channels[0].sampler.output[c];b instanceof THREE.Matrix4&&(a.world.copy(b),a.localworld.copy(b),0===c&&a.matrix.copy(b))}m&&a.world.multiplyMatrices(m,a.world);d.push(a);for(m=0;m<a.nodes.length;m++)g(a.nodes[m],d,c,a.world)}function h(a,d){for(var c=0;c<a.length;c++){var m=a[c],b=-1;if("JOINT"==m.type){for(var q=0;q<d.joints.length;q++)if(m.sid===d.joints[q]){b=q;break}if(0<=b)for(q=d.invBindMatrices[b],m.invBindMatrix=q,m.skinningMatrix=new THREE.Matrix4,m.skinningMatrix.multiplyMatrices(m.world,
q),m.animatrix=new THREE.Matrix4,m.animatrix.copy(m.localworld),m.weights=[],q=0;q<d.weights.length;q++)for(var e=0;e<d.weights[q].length;e++){var f=d.weights[q][e];f.joint===b&&m.weights.push(f)}else console.warn("ColladaLoader: Could not find joint '"+m.sid+"'."),m.skinningMatrix=new THREE.Matrix4,m.weights=[]}}}function r(a){var d=[],c=function(a,d,b){var e={};e.name=d.sid;e.parent=a;e.matrix=d.matrix;a=[new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3];e.matrix.decompose(a[0],a[1],a[2]);
e.pos=[a[0].x,a[0].y,a[0].z];e.scl=[a[2].x,a[2].y,a[2].z];e.rotq=[a[1].x,a[1].y,a[1].z,a[1].w];b.push(e);for(var f in d.nodes)c(d.sid,d.nodes[f],b)};c(-1,a,d);return d}function p(a,d,c){var m,b=Q[d.url];if(b&&b.skin)if(d.skeleton&&d.skeleton.length){var q=0,e;for(m in T){c=T[m];e=e||c.id;for(var f=0;f<c.sampler.length;f++){var k=c.sampler[f];k.create();q=Math.max(q,k.input.length)}}m=q;c=e;d=H.getChildById(d.skeleton[0],!0)||H.getChildBySid(d.skeleton[0],!0);e=r(d);for(var l=b.skin.joints,f=[],q=
0;q<l.length;q++)for(k=0;k<e.length;k++)e[k].name===l[q]&&(f[q]=e[k]);for(q=0;q<f.length;q++)for(k=0;k<f.length;k++)f[q].parent===f[k].name&&(f[q].parent=k);new THREE.Vector3;for(q=0;q<a.vertices.length;q++)a.vertices[q].applyMatrix4(b.skin.bindShapeMatrix);for(var k=[],l=[],n=b.skin.weights,q=0;q<n.length;q++){var P=new THREE.Vector4(n[q][0]?n[q][0].joint:0,n[q][1]?n[q][1].joint:0,n[q][2]?n[q][2].joint:0,n[q][3]?n[q][3].joint:0);e=new THREE.Vector4(n[q][0]?n[q][0].weight:0,n[q][1]?n[q][1].weight:
0,n[q][2]?n[q][2].weight:0,n[q][3]?n[q][3].weight:0);k.push(P);l.push(e)}a.skinIndices=k;a.skinWeights=l;a.bones=f;e={name:c,fps:30,length:m/30,hierarchy:[]};for(k=0;k<f.length;k++)e.hierarchy.push({parent:f[k].parent,name:f[k].name,keys:[]});console.log("ColladaLoader:",c+" has "+f.length+" bones.");q=[];g(d,q,-1);h(q,b.skin);c=new THREE.Vector3;f=[];for(k=0;k<a.vertices.length;k++)f.push(new THREE.Vector3);for(k=0;k<q.length;k++)if("JOINT"==q[k].type)for(l=0;l<q[k].weights.length;l++){var P=q[k].weights[l],
n=P.index,P=P.weight,w=a.vertices[n],n=f[n];c.x=w.x;c.y=w.y;c.z=w.z;c.applyMatrix4(q[k].skinningMatrix);n.x+=c.x*P;n.y+=c.y*P;n.z+=c.z*P}for(k=0;k<a.vertices.length;k++)a.vertices[k]=f[k];for(c=0;c<m;c++){f=[];g(d,f,c);h(f,b.skin);for(q=0;q<f.length;q++)for(k=0;k<e.hierarchy.length;k++)e.hierarchy[k].name===f[q].sid&&(l={},l.time=c/30,l.matrix=f[q].animatrix,0===c&&(f[q].matrix=l.matrix),n=[new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3],l.matrix.decompose(n[0],n[1],n[2]),l.pos=[n[0].x,
n[0].y,n[0].z],l.scl=[n[2].x,n[2].y,n[2].z],l.rot=n[1],e.hierarchy[k].keys.push(l));a.animation=e}}else console.log("ColladaLoader: Could not find the skeleton for the skin. ");else console.log("ColladaLoader: Could not find skin controller.")}function ea(){if(O&&0===O.joints.length)ya=void 0;else{var a={},d=function(c,d){var m=d.getAttribute("id"),b=H.getChildById(m,!0),e=O.joints[c];U.traverse(function(d){d.colladaId==m&&(a[c]={node:d,transforms:b.transforms,joint:e,position:e.zeroPosition})})};
ya={joints:O&&O.joints,getJointValue:function(c){var d=a[c];if(d)return d.position;console.log("getJointValue: joint "+c+" doesn't exist")},setJointValue:function(c,d){var b=a[c];if(b){var e=b.joint;if(d>e.limits.max||d<e.limits.min)console.log("setJointValue: joint "+c+" value "+d+" outside of limits (min: "+e.limits.min+", max: "+e.limits.max+")");else if(e["static"])console.log("setJointValue: joint "+c+" is static");else{var q=b.node,f=e.axis,b=b.transforms,V=new THREE.Matrix4;for(m=0;m<b.length;m++){var g=
b[m];if(g.sid&&-1!==g.sid.indexOf("joint"+c))switch(e.type){case "revolute":V.multiply(h.makeRotationAxis(f,THREE.Math.degToRad(d)));break;case "prismatic":V.multiply(h.makeTranslation(f.x*d,f.y*d,f.z*d));break;default:console.warn("setJointValue: unknown joint type: "+e.type)}else{var h=new THREE.Matrix4;switch(g.type){case "matrix":V.multiply(g.obj);break;case "translate":V.multiply(h.makeTranslation(g.obj.x,g.obj.y,g.obj.z));break;case "rotate":V.multiply(h.makeRotationAxis(g.obj,g.angle))}}}e=
Array.prototype.slice.call(V.elements);q.matrix.set.apply(q.matrix,[e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]]);q.matrix.decompose(q.position,q.quaternion,q.scale)}}else console.log("setJointValue: joint "+c+" doesn't exist")}};var c=L.querySelector("scene instance_kinematics_scene");if(c)for(var m=0;m<c.childNodes.length;m++){var b=c.childNodes[m];if(1==b.nodeType)switch(b.nodeName){case "bind_joint_axis":var e=b.getAttribute("target").split("/").pop(),
b=b.querySelector("axis param").textContent,b=parseInt(b.split("joint").pop().split(".")[0]);(e=L.querySelector('[sid="'+e+'"]'))&&d(b,e.parentElement)}}}}function B(a,d){var c=new THREE.Object3D,m,b,e,f;for(e=0;e<a.controllers.length;e++){var g=Q[a.controllers[e].url];switch(g.type){case "skin":if(N[g.skin.source]){var k=new aa;k.url=g.skin.source;k.instance_material=a.controllers[e].instance_material;a.geometries.push(k);m=a.controllers[e]}else Q[g.skin.source]&&(b=g=Q[g.skin.source],g.morph&&N[g.morph.source]&&
(k=new aa,k.url=g.morph.source,k.instance_material=a.controllers[e].instance_material,a.geometries.push(k)));break;case "morph":N[g.morph.source]&&(k=new aa,k.url=g.morph.source,k.instance_material=a.controllers[e].instance_material,a.geometries.push(k),b=a.controllers[e]),console.log("ColladaLoader: Morph-controller partially supported.")}}k={};for(e=0;e<a.geometries.length;e++){f=a.geometries[e];var g=f.instance_material,l=N[f.url],n={},h=[],w=0,r;if(l&&l.mesh&&l.mesh.primitives){0===c.name.length&&
(c.name=l.id);if(g)for(f=0;f<g.length;f++){r=g[f];var t=oa[r.target],u=pa[t.instance_effect.url].shader.material;l.doubleSided&&(r.symbol in k||(u=u.clone(),u.side=THREE.DoubleSide,k[r.symbol]=u),u=k[r.symbol]);u.opacity=u.opacity?u.opacity:1;n[r.symbol]=w;h.push(u);r=u;r.name=null===t.name||""===t.name?t.id:t.name;w++}g=r||new THREE.MeshLambertMaterial({color:14540253,side:l.doubleSided?THREE.DoubleSide:THREE.FrontSide});l=l.mesh.geometry3js;if(1<w)for(g=new THREE.MultiMaterial(h),f=0;f<l.faces.length;f++)h=
l.faces[f],h.materialIndex=n[h.daeMaterial];if(void 0!==m)p(l,m),0<l.morphTargets.length?(g.morphTargets=!0,g.skinning=!1):(g.morphTargets=!1,g.skinning=!0),g=new THREE.SkinnedMesh(l,g,!1),g.name="skin_"+ia.length,ia.push(g);else if(void 0!==b){f=l;if((n=b instanceof x?Q[b.url]:b)&&n.morph){n=n.morph;for(h=0;h<n.targets.length;h++)w=N[n.targets[h]],w.mesh&&w.mesh.primitives&&w.mesh.primitives.length&&(w=w.mesh.primitives[0].geometry,w.vertices.length===f.vertices.length&&f.morphTargets.push({name:"target_1",
vertices:w.vertices}));f.morphTargets.push({name:"target_Z",vertices:f.vertices})}else console.log("could not find morph controller!");g.morphTargets=!0;g=new THREE.Mesh(l,g);g.name="morph_"+ha.length;ha.push(g)}else g=!0===l.isLineStrip?new THREE.Line(l):new THREE.Mesh(l,g);c.add(g)}}for(e=0;e<a.cameras.length;e++)m=qa[a.cameras[e].url],m=new THREE.PerspectiveCamera(m.yfov||m.xfov,parseFloat(m.aspect_ratio),parseFloat(m.znear),parseFloat(m.zfar)),c.add(m);for(e=0;e<a.lights.length;e++){m=null;if((b=
sa[a.lights[e].url])&&b.technique)switch(k=b.color.getHex(),r=b.intensity,g=b.distance,f=b.falloff_angle,b.technique){case "directional":m=new THREE.DirectionalLight(k,r,g);m.position.set(0,0,1);break;case "point":m=new THREE.PointLight(k,r,g);break;case "spot":m=new THREE.SpotLight(k,r,g,f);m.position.set(0,0,1);break;case "ambient":m=new THREE.AmbientLight(k)}m&&c.add(m)}c.name=a.name||a.id||"";c.colladaId=a.id||"";c.layer=a.layer||"";c.matrix=a.matrix;c.matrix.decompose(c.position,c.quaternion,
c.scale);D.centerGeometry&&c.geometry&&(e=c.geometry.center(),e.multiply(c.scale),e.applyQuaternion(c.quaternion),c.position.sub(e));for(e=0;e<a.nodes.length;e++)c.add(B(a.nodes[e],a));return c}function K(){this.init_from=this.id=""}function C(){this.type=this.name=this.id="";this.morph=this.skin=null}function y(){this.weights=this.targets=this.source=this.method=null}function t(){this.source="";this.bindShapeMatrix=null;this.invBindMatrices=[];this.joints=[];this.weights=[]}function v(){this.name=
this.id="";this.nodes=[];this.scene=new THREE.Group}function z(){this.sid=this.name=this.id="";this.nodes=[];this.controllers=[];this.transforms=[];this.geometries=[];this.channels=[];this.matrix=new THREE.Matrix4}function u(){this.type=this.sid="";this.data=[];this.obj=null}function x(){this.url="";this.skeleton=[];this.instance_material=[]}function F(){this.target=this.symbol=""}function aa(){this.url="";this.instance_material=[]}function Ha(){this.id="";this.mesh=null}function za(a){this.geometry=
a.id;this.primitives=[];this.geometry3js=this.vertices=null}function J(){this.material="";this.count=0;this.inputs=[];this.vcount=null;this.p=[];this.geometry=new THREE.Geometry}function ja(){J.call(this);this.vcount=[]}function ba(){J.call(this);this.vcount=1}function ka(){J.call(this);this.vcount=3}function Ia(){this.source="";this.stride=this.count=0;this.params=[]}function Ja(){this.input={}}function R(){this.semantic="";this.offset=0;this.source="";this.set=0}function W(a){this.id=a;this.type=
null}function Ga(){this.name=this.id="";this.instance_effect=null}function I(){this.color=new THREE.Color;this.color.setRGB(Math.random(),Math.random(),Math.random());this.color.a=1;this.texOpts=this.texcoord=this.texture=null}function Aa(a,d){this.type=a;this.effect=d;this.material=null}function Ka(a){this.effect=a;this.format=this.init_from=null}function La(a){this.effect=a;this.mipfilter=this.magfilter=this.minfilter=this.wrap_t=this.wrap_s=this.source=null}function M(){this.name=this.id="";this.shader=
null;this.surface={};this.sampler={}}function Ma(){this.url=""}function ta(){this.name=this.id="";this.source={};this.sampler=[];this.channel=[]}function Na(a){this.animation=a;this.target=this.source="";this.member=this.arrIndices=this.arrSyntax=this.dotSyntax=this.sid=this.fullSid=null}function la(a){this.id="";this.animation=a;this.inputs=[];this.endTime=this.startTime=this.interpolation=this.strideOut=this.output=this.input=null;this.duration=0}function X(a){this.targets=[];this.time=a}function ra(){this.technique=
this.name=this.id=""}function Oa(){this.url=""}function ga(){this.technique=this.name=this.id=""}function Pa(){this.url=""}function wa(){this.name=this.id="";this.joints=[];this.links=[]}function Qa(){this.name=this.sid="";this.axis=new THREE.Vector3;this.limits={min:0,max:0};this.type="";this["static"]=!1;this.middlePosition=this.zeroPosition=0}function Ba(){this.name=this.sid="";this.transforms=[];this.attachments=[]}function Ra(){this.joint="";this.transforms=[];this.links=[]}function Y(a){a=ma(a);
for(var d=[],c=0,m=a.length;c<m;c++)d.push(parseFloat(a[c]));return d}function ca(a){a=ma(a);for(var d=[],c=0,m=a.length;c<m;c++)d.push(parseInt(a[c],10));return d}function ma(a){return 0<a.length?a.replace(/^\s+/,"").replace(/\s+$/,"").split(/\s+/):[]}function da(a,d,c){return a.hasAttribute(d)?parseInt(a.getAttribute(d),10):c}function Va(a,d){(new THREE.ImageLoader).load(d,function(c){a.image=c;a.needsUpdate=!0})}function Sa(a,d){a.doubleSided=!1;var c=d.querySelectorAll("extra double_sided")[0];
c&&c&&1===parseInt(c.textContent,10)&&(a.doubleSided=!0)}function E(a,d){if(!0===D.convertUpAxis&&Z!==D.upAxis)switch(G){case "XtoY":var c=a[0];a[0]=d*a[1];a[1]=c;break;case "XtoZ":c=a[2];a[2]=a[1];a[1]=a[0];a[0]=c;break;case "YtoX":c=a[0];a[0]=a[1];a[1]=d*c;break;case "YtoZ":c=a[1];a[1]=d*a[2];a[2]=c;break;case "ZtoX":c=a[0];a[0]=a[1];a[1]=a[2];a[2]=c;break;case "ZtoY":c=a[1],a[1]=a[2],a[2]=d*c}}function na(a,d){var c=[a[d],a[d+1],a[d+2]];E(c,-1);return new THREE.Vector3(c[0],c[1],c[2])}function Ca(a){if(D.convertUpAxis){var d=
[a[0],a[4],a[8]];E(d,-1);a[0]=d[0];a[4]=d[1];a[8]=d[2];d=[a[1],a[5],a[9]];E(d,-1);a[1]=d[0];a[5]=d[1];a[9]=d[2];d=[a[2],a[6],a[10]];E(d,-1);a[2]=d[0];a[6]=d[1];a[10]=d[2];d=[a[0],a[1],a[2]];E(d,-1);a[0]=d[0];a[1]=d[1];a[2]=d[2];d=[a[4],a[5],a[6]];E(d,-1);a[4]=d[0];a[5]=d[1];a[6]=d[2];d=[a[8],a[9],a[10]];E(d,-1);a[8]=d[0];a[9]=d[1];a[10]=d[2];d=[a[3],a[7],a[11]];E(d,-1);a[3]=d[0];a[7]=d[1];a[11]=d[2]}return(new THREE.Matrix4).set(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],
a[13],a[14],a[15])}function Ta(a){if(D.convertUpAxis)switch(a){case "X":switch(G){case "XtoY":case "XtoZ":case "YtoX":a="Y";break;case "ZtoX":a="Z"}break;case "Y":switch(G){case "XtoY":case "YtoX":case "ZtoX":a="X";break;case "XtoZ":case "YtoZ":case "ZtoY":a="Z"}break;case "Z":switch(G){case "XtoZ":a="X";break;case "YtoZ":case "ZtoX":case "ZtoY":a="Y"}}return a}var L=null,U=null,H,O,Da=null,S={},fa={},T={},Q={},N={},oa={},pa={},qa={},sa={},xa,ya,ua,va,Ea,ha,ia,Ua=THREE.SmoothShading,D={centerGeometry:!1,
convertUpAxis:!1,subdivideFaces:!0,upAxis:"Y",defaultEnvMap:null},Fa=1,Z="Y",G=null;K.prototype.parse=function(a){this.id=a.getAttribute("id");for(var d=0;d<a.childNodes.length;d++){var c=a.childNodes[d];"init_from"===c.nodeName&&(this.init_from=c.textContent)}return this};C.prototype.parse=function(a){this.id=a.getAttribute("id");this.name=a.getAttribute("name");this.type="none";for(var d=0;d<a.childNodes.length;d++){var c=a.childNodes[d];switch(c.nodeName){case "skin":this.skin=(new t).parse(c);
this.type=c.nodeName;break;case "morph":this.morph=(new y).parse(c),this.type=c.nodeName}}return this};y.prototype.parse=function(a){var d={},c=[],m;this.method=a.getAttribute("method");this.source=a.getAttribute("source").replace(/^#/,"");for(m=0;m<a.childNodes.length;m++){var b=a.childNodes[m];if(1==b.nodeType)switch(b.nodeName){case "source":b=(new W).parse(b);d[b.id]=b;break;case "targets":c=this.parseInputs(b);break;default:console.log(b.nodeName)}}for(m=0;m<c.length;m++)switch(a=c[m],b=d[a.source],
a.semantic){case "MORPH_TARGET":this.targets=b.read();break;case "MORPH_WEIGHT":this.weights=b.read()}return this};y.prototype.parseInputs=function(a){for(var d=[],c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if(1==b.nodeType)switch(b.nodeName){case "input":d.push((new R).parse(b))}}return d};t.prototype.parse=function(a){var d={},c,b;this.source=a.getAttribute("source").replace(/^#/,"");this.invBindMatrices=[];this.joints=[];this.weights=[];for(var e=0;e<a.childNodes.length;e++){var f=a.childNodes[e];
if(1==f.nodeType)switch(f.nodeName){case "bind_shape_matrix":f=Y(f.textContent);this.bindShapeMatrix=Ca(f);break;case "source":f=(new W).parse(f);d[f.id]=f;break;case "joints":c=f;break;case "vertex_weights":b=f;break;default:console.log(f.nodeName)}}this.parseJoints(c,d);this.parseWeights(b,d);return this};t.prototype.parseJoints=function(a,d){for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if(1==b.nodeType)switch(b.nodeName){case "input":var b=(new R).parse(b),e=d[b.source];"JOINT"===
b.semantic?this.joints=e.read():"INV_BIND_MATRIX"===b.semantic&&(this.invBindMatrices=e.read())}}};t.prototype.parseWeights=function(a,d){for(var c,b,e=[],f=0;f<a.childNodes.length;f++){var g=a.childNodes[f];if(1==g.nodeType)switch(g.nodeName){case "input":e.push((new R).parse(g));break;case "v":c=ca(g.textContent);break;case "vcount":b=ca(g.textContent)}}for(f=g=0;f<b.length;f++){for(var h=b[f],k=[],l=0;l<h;l++){for(var n={},r=0;r<e.length;r++){var w=e[r],p=c[g+w.offset];switch(w.semantic){case "JOINT":n.joint=
p;break;case "WEIGHT":n.weight=d[w.source].data[p]}}k.push(n);g+=e.length}for(l=0;l<k.length;l++)k[l].index=f;this.weights.push(k)}};v.prototype.getChildById=function(a,d){for(var c=0;c<this.nodes.length;c++){var b=this.nodes[c].getChildById(a,d);if(b)return b}return null};v.prototype.getChildBySid=function(a,d){for(var c=0;c<this.nodes.length;c++){var b=this.nodes[c].getChildBySid(a,d);if(b)return b}return null};v.prototype.parse=function(a){this.id=a.getAttribute("id");this.name=a.getAttribute("name");
this.nodes=[];for(var d=0;d<a.childNodes.length;d++){var c=a.childNodes[d];if(1==c.nodeType)switch(c.nodeName){case "node":this.nodes.push((new z).parse(c))}}return this};z.prototype.getChannelForTransform=function(a){for(var d=0;d<this.channels.length;d++){var c=this.channels[d],b=c.target.split("/");b.shift();var e=b.shift(),f=0<=e.indexOf("."),g=0<=e.indexOf("("),h;if(f)b=e.split("."),e=b.shift(),b.shift();else if(g)for(h=e.split("("),e=h.shift(),b=0;b<h.length;b++)h[b]=parseInt(h[b].replace(/\)/,
""));if(e===a)return c.info={sid:e,dotSyntax:f,arrSyntax:g,arrIndices:h},c}return null};z.prototype.getChildById=function(a,d){if(this.id===a)return this;if(d)for(var c=0;c<this.nodes.length;c++){var b=this.nodes[c].getChildById(a,d);if(b)return b}return null};z.prototype.getChildBySid=function(a,d){if(this.sid===a)return this;if(d)for(var c=0;c<this.nodes.length;c++){var b=this.nodes[c].getChildBySid(a,d);if(b)return b}return null};z.prototype.getTransformBySid=function(a){for(var d=0;d<this.transforms.length;d++)if(this.transforms[d].sid===
a)return this.transforms[d];return null};z.prototype.parse=function(a){var d;this.id=a.getAttribute("id");this.sid=a.getAttribute("sid");this.name=a.getAttribute("name");this.type=a.getAttribute("type");this.layer=a.getAttribute("layer");this.type="JOINT"===this.type?this.type:"NODE";this.nodes=[];this.transforms=[];this.geometries=[];this.cameras=[];this.lights=[];this.controllers=[];this.matrix=new THREE.Matrix4;for(var c=0;c<a.childNodes.length;c++)if(d=a.childNodes[c],1==d.nodeType)switch(d.nodeName){case "node":this.nodes.push((new z).parse(d));
break;case "instance_camera":this.cameras.push((new Oa).parse(d));break;case "instance_controller":this.controllers.push((new x).parse(d));break;case "instance_geometry":this.geometries.push((new aa).parse(d));break;case "instance_light":this.lights.push((new Pa).parse(d));break;case "instance_node":d=d.getAttribute("url").replace(/^#/,"");a:{for(var b=L.querySelectorAll("library_nodes node"),e=0;e<b.length;e++){var f=b[e].attributes.getNamedItem("id");if(f&&f.value===d){d=b[e];break a}}d=void 0}d&&
this.nodes.push((new z).parse(d));break;case "rotate":case "translate":case "scale":case "matrix":case "lookat":case "skew":this.transforms.push((new u).parse(d));break;case "extra":break;default:console.log(d.nodeName)}a=[];c=1E6;d=-1E6;for(var g in T)for(b=T[g],e=0;e<b.channel.length;e++){var f=b.channel[e],h=b.sampler[e];g=f.target.split("/")[0];g==this.id&&(h.create(),f.sampler=h,c=Math.min(c,h.startTime),d=Math.max(d,h.endTime),a.push(f))}a.length&&(this.startTime=c,this.endTime=d);if((this.channels=
a)&&this.channels.length){g=[];a=[];c=0;for(b=this.channels.length;c<b;c++){var k=this.channels[c],e=k.fullSid,f=k.sampler,h=f.input,l=this.getTransformBySid(k.sid),n;if(k.arrIndices){n=[];d=0;for(var r=k.arrIndices.length;d<r;d++){var w=n,p=d,t=k.arrIndices[d];-1<t&&3>t&&(t=Ta(["X","Y","Z"][t]),t={X:0,Y:1,Z:2}[t]);w[p]=t}}else n=Ta(k.member);if(l)for(-1===a.indexOf(e)&&a.push(e),d=0,r=h.length;d<r;d++){for(var w=h[d],k=f.getData(l.type,d,n),p=null,t=0,v=g.length;t<v&&null===p;t++){var y=g[t];if(y.time===
w)p=y;else if(y.time>w)break}if(!p){p=new X(w);t=-1;v=0;for(y=g.length;v<y&&-1===t;v++)g[v].time>=w&&(t=v);w=t;g.splice(-1===w?g.length:w,0,p)}p.addTarget(e,l,n,k)}else console.log('Could not find transform "'+k.sid+'" in node '+this.id)}for(c=0;c<a.length;c++)for(b=a[c],d=0;d<g.length;d++)if(p=g[d],!p.hasTarget(b)){h=g;e=p;n=d;f=b;a:{l=n?n-1:0;for(l=0<=l?l:l+h.length;0<=l;l--)if(r=h[l],r.hasTarget(f)){l=r;break a}l=null}a:{for(n+=1;n<h.length;n++)if(r=h[n],r.hasTarget(f)){n=r;break a}n=null}if(l&&
n){h=(e.time-l.time)/(n.time-l.time);l=l.getTarget(f);n=n.getTarget(f).data;r=l.data;if("matrix"===l.type)k=r;else if(r.length)for(k=[],w=0;w<r.length;++w)k[w]=r[w]+(n[w]-r[w])*h;else k=r+(n-r)*h;e.addTarget(f,l.transform,l.member,k)}}this.keys=g;this.sids=a}this.updateMatrix();return this};z.prototype.updateMatrix=function(){this.matrix.identity();for(var a=0;a<this.transforms.length;a++)this.transforms[a].apply(this.matrix)};u.prototype.parse=function(a){this.sid=a.getAttribute("sid");this.type=
a.nodeName;this.data=Y(a.textContent);this.convert();return this};u.prototype.convert=function(){switch(this.type){case "matrix":this.obj=Ca(this.data);break;case "rotate":this.angle=THREE.Math.degToRad(this.data[3]);case "translate":E(this.data,-1);this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;case "scale":E(this.data,1);this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}};u.prototype.apply=
function(){var a=new THREE.Matrix4;return function(d){switch(this.type){case "matrix":d.multiply(this.obj);break;case "translate":d.multiply(a.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case "rotate":d.multiply(a.makeRotationAxis(this.obj,this.angle));break;case "scale":d.scale(this.obj)}}}();u.prototype.update=function(a,d){var c=["X","Y","Z","ANGLE"];switch(this.type){case "matrix":if(d)if(1===d.length)switch(d[0]){case 0:this.obj.n11=a[0];this.obj.n21=a[1];this.obj.n31=a[2];this.obj.n41=
a[3];break;case 1:this.obj.n12=a[0];this.obj.n22=a[1];this.obj.n32=a[2];this.obj.n42=a[3];break;case 2:this.obj.n13=a[0];this.obj.n23=a[1];this.obj.n33=a[2];this.obj.n43=a[3];break;case 3:this.obj.n14=a[0],this.obj.n24=a[1],this.obj.n34=a[2],this.obj.n44=a[3]}else 2===d.length?this.obj["n"+(d[0]+1)+(d[1]+1)]=a:console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(a);break;case "translate":case "scale":"[object Array]"===Object.prototype.toString.call(d)&&(d=c[d[0]]);switch(d){case "X":this.obj.x=
a;break;case "Y":this.obj.y=a;break;case "Z":this.obj.z=a;break;default:this.obj.x=a[0],this.obj.y=a[1],this.obj.z=a[2]}break;case "rotate":switch("[object Array]"===Object.prototype.toString.call(d)&&(d=c[d[0]]),d){case "X":this.obj.x=a;break;case "Y":this.obj.y=a;break;case "Z":this.obj.z=a;break;case "ANGLE":this.angle=THREE.Math.degToRad(a);break;default:this.obj.x=a[0],this.obj.y=a[1],this.obj.z=a[2],this.angle=THREE.Math.degToRad(a[3])}}};x.prototype.parse=function(a){this.url=a.getAttribute("url").replace(/^#/,
"");this.skeleton=[];this.instance_material=[];for(var d=0;d<a.childNodes.length;d++){var c=a.childNodes[d];if(1===c.nodeType)switch(c.nodeName){case "skeleton":this.skeleton.push(c.textContent.replace(/^#/,""));break;case "bind_material":for(var c=c.querySelectorAll("instance_material"),b=0;b<c.length;b++){var e=c[b];this.instance_material.push((new F).parse(e))}}}return this};F.prototype.parse=function(a){this.symbol=a.getAttribute("symbol");this.target=a.getAttribute("target").replace(/^#/,"");
return this};aa.prototype.parse=function(a){this.url=a.getAttribute("url").replace(/^#/,"");this.instance_material=[];for(var d=0;d<a.childNodes.length;d++){var c=a.childNodes[d];if(1==c.nodeType&&"bind_material"===c.nodeName){a=c.querySelectorAll("instance_material");for(d=0;d<a.length;d++)c=a[d],this.instance_material.push((new F).parse(c));break}}return this};Ha.prototype.parse=function(a){this.id=a.getAttribute("id");Sa(this,a);for(var d=0;d<a.childNodes.length;d++){var c=a.childNodes[d];switch(c.nodeName){case "mesh":this.mesh=
(new za(this)).parse(c)}}return this};za.prototype.parse=function(a){this.primitives=[];for(var d=0;d<a.childNodes.length;d++){var c=a.childNodes[d];switch(c.nodeName){case "source":var b=c.getAttribute("id");void 0==S[b]&&(S[b]=(new W(b)).parse(c));break;case "vertices":this.vertices=(new Ja).parse(c);break;case "linestrips":this.primitives.push((new ba).parse(c));break;case "triangles":this.primitives.push((new ka).parse(c));break;case "polygons":this.primitives.push((new J).parse(c));break;case "polylist":this.primitives.push((new ja).parse(c))}}this.geometry3js=
new THREE.Geometry;if(null===this.vertices)return this;a=S[this.vertices.input.POSITION.source].data;for(d=0;d<a.length;d+=3)this.geometry3js.vertices.push(na(a,d).clone());for(d=0;d<this.primitives.length;d++)a=this.primitives[d],a.setVertices(this.vertices),this.handlePrimitive(a,this.geometry3js);this.geometry3js.calcNormals&&(this.geometry3js.computeVertexNormals(),delete this.geometry3js.calcNormals);return this};za.prototype.handlePrimitive=function(a,d){if(a instanceof ba)d.isLineStrip=!0;
else{var c,b,e=a.p,f=a.inputs,g,h,k,l,n,r=0,p,t=0,u=[];for(c=0;c<f.length;c++)switch(g=f[c],p=g.offset+1,t=t<p?p:t,g.semantic){case "TEXCOORD":u.push(g.set)}for(var v=0;v<e.length;++v)for(var y=e[v],z=0;z<y.length;){var A=[],x=[],C=null,B=[];p=a.vcount?a.vcount.length?a.vcount[r++]:a.vcount:y.length/t;for(c=0;c<p;c++)for(b=0;b<f.length;b++)switch(g=f[b],l=S[g.source],h=y[z+c*t+g.offset],n=l.accessor.params.length,k=h*n,g.semantic){case "VERTEX":A.push(h);break;case "NORMAL":x.push(na(l.data,k));break;
case "TEXCOORD":C=C||{};void 0===C[g.set]&&(C[g.set]=[]);C[g.set].push(new THREE.Vector2(l.data[k],l.data[k+1]));break;case "COLOR":B.push((new THREE.Color).setRGB(l.data[k],l.data[k+1],l.data[k+2]))}if(0===x.length)if(g=this.vertices.input.NORMAL)for(l=S[g.source],n=l.accessor.params.length,c=0,h=A.length;c<h;c++)x.push(na(l.data,A[c]*n));else d.calcNormals=!0;if(!C&&(C={},g=this.vertices.input.TEXCOORD))for(u.push(g.set),l=S[g.source],n=l.accessor.params.length,c=0,h=A.length;c<h;c++)k=A[c]*n,void 0===
C[g.set]&&(C[g.set]=[]),C[g.set].push(new THREE.Vector2(l.data[k],1-l.data[k+1]));if(0===B.length&&(g=this.vertices.input.COLOR))for(l=S[g.source],n=l.accessor.params.length,c=0,h=A.length;c<h;c++)k=A[c]*n,B.push((new THREE.Color).setRGB(l.data[k],l.data[k+1],l.data[k+2]));g=[];if(3===p)g.push(new THREE.Face3(A[0],A[1],A[2],x,B.length?B:new THREE.Color));else if(4===p)g.push(new THREE.Face3(A[0],A[1],A[3],x.length?[x[0].clone(),x[1].clone(),x[3].clone()]:[],B.length?[B[0],B[1],B[3]]:new THREE.Color)),
g.push(new THREE.Face3(A[1],A[2],A[3],x.length?[x[1].clone(),x[2].clone(),x[3].clone()]:[],B.length?[B[1],B[2],B[3]]:new THREE.Color));else if(4<p&&D.subdivideFaces)for(c=B.length?B:new THREE.Color,b=1;b<p-1;)g.push(new THREE.Face3(A[0],A[b],A[b+1],x.length?[x[0].clone(),x[b++].clone(),x[b].clone()]:[],c));if(g.length)for(c=0,h=g.length;c<h;c++)for(b=g[c],b.daeMaterial=a.material,d.faces.push(b),b=0;b<u.length;b++)A=C[u[b]],A=4<p?[A[0],A[c+1],A[c+2]]:4===p?0===c?[A[0],A[1],A[3]]:[A[1].clone(),A[2],
A[3].clone()]:[A[0],A[1],A[2]],void 0===d.faceVertexUvs[b]&&(d.faceVertexUvs[b]=[]),d.faceVertexUvs[b].push(A);else console.log("dropped face with vcount "+p+" for geometry with id: "+d.id);z+=t*p}}};J.prototype.setVertices=function(a){for(var d=0;d<this.inputs.length;d++)this.inputs[d].source===a.id&&(this.inputs[d].source=a.input.POSITION.source)};J.prototype.parse=function(a){this.material=a.getAttribute("material");this.count=da(a,"count",0);for(var d=0;d<a.childNodes.length;d++){var c=a.childNodes[d];
switch(c.nodeName){case "input":this.inputs.push((new R).parse(a.childNodes[d]));break;case "vcount":this.vcount=ca(c.textContent);break;case "p":this.p.push(ca(c.textContent));break;case "ph":console.warn("polygon holes not yet supported!")}}return this};ja.prototype=Object.create(J.prototype);ja.prototype.constructor=ja;ba.prototype=Object.create(J.prototype);ba.prototype.constructor=ba;ka.prototype=Object.create(J.prototype);ka.prototype.constructor=ka;Ia.prototype.parse=function(a){this.params=
[];this.source=a.getAttribute("source");this.count=da(a,"count",0);this.stride=da(a,"stride",0);for(var d=0;d<a.childNodes.length;d++){var c=a.childNodes[d];if("param"===c.nodeName){var b={};b.name=c.getAttribute("name");b.type=c.getAttribute("type");this.params.push(b)}}return this};Ja.prototype.parse=function(a){this.id=a.getAttribute("id");for(var d=0;d<a.childNodes.length;d++)if("input"===a.childNodes[d].nodeName){var c=(new R).parse(a.childNodes[d]);this.input[c.semantic]=c}return this};R.prototype.parse=
function(a){this.semantic=a.getAttribute("semantic");this.source=a.getAttribute("source").replace(/^#/,"");this.set=da(a,"set",-1);this.offset=da(a,"offset",0);"TEXCOORD"===this.semantic&&0>this.set&&(this.set=0);return this};W.prototype.parse=function(a){this.id=a.getAttribute("id");for(var d=0;d<a.childNodes.length;d++){var c=a.childNodes[d];switch(c.nodeName){case "bool_array":for(var b=ma(c.textContent),e=[],f=0,g=b.length;f<g;f++)e.push("true"===b[f]||"1"===b[f]?!0:!1);this.data=e;this.type=
c.nodeName;break;case "float_array":this.data=Y(c.textContent);this.type=c.nodeName;break;case "int_array":this.data=ca(c.textContent);this.type=c.nodeName;break;case "IDREF_array":case "Name_array":this.data=ma(c.textContent);this.type=c.nodeName;break;case "technique_common":for(b=0;b<c.childNodes.length;b++)if("accessor"===c.childNodes[b].nodeName){this.accessor=(new Ia).parse(c.childNodes[b]);break}}}return this};W.prototype.read=function(){var a=[],d=this.accessor.params[0];switch(d.type){case "IDREF":case "Name":case "name":case "float":return this.data;
case "float4x4":for(d=0;d<this.data.length;d+=16){var c=this.data.slice(d,d+16),c=Ca(c);a.push(c)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+d.type+".")}return a};Ga.prototype.parse=function(a){this.id=a.getAttribute("id");this.name=a.getAttribute("name");for(var d=0;d<a.childNodes.length;d++)if("instance_effect"===a.childNodes[d].nodeName){this.instance_effect=(new Ma).parse(a.childNodes[d]);break}return this};I.prototype.isColor=function(){return null===this.texture};
I.prototype.isTexture=function(){return null!=this.texture};I.prototype.parse=function(a){"transparent"===a.nodeName&&(this.opaque=a.getAttribute("opaque"));for(var d=0;d<a.childNodes.length;d++){var c=a.childNodes[d];if(1==c.nodeType)switch(c.nodeName){case "color":c=Y(c.textContent);this.color=new THREE.Color;this.color.setRGB(c[0],c[1],c[2]);this.color.a=c[3];break;case "texture":this.texture=c.getAttribute("texture"),this.texcoord=c.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,
repeatV:1,wrapU:1,wrapV:1},this.parseTexture(c)}}return this};I.prototype.parseTexture=function(a){if(!a.childNodes)return this;a.childNodes[1]&&"extra"===a.childNodes[1].nodeName&&(a=a.childNodes[1],a.childNodes[1]&&"technique"===a.childNodes[1].nodeName&&(a=a.childNodes[1]));for(var d=0;d<a.childNodes.length;d++){var c=a.childNodes[d];switch(c.nodeName){case "offsetU":case "offsetV":case "repeatU":case "repeatV":this.texOpts[c.nodeName]=parseFloat(c.textContent);break;case "wrapU":case "wrapV":"TRUE"===
c.textContent.toUpperCase()?this.texOpts[c.nodeName]=1:this.texOpts[c.nodeName]=parseInt(c.textContent);break;default:this.texOpts[c.nodeName]=c.textContent}}return this};Aa.prototype.parse=function(a){for(var d=0;d<a.childNodes.length;d++){var c=a.childNodes[d];if(1==c.nodeType)switch(c.nodeName){case "emission":case "diffuse":case "specular":case "transparent":this[c.nodeName]=(new I).parse(c);break;case "bump":var b=c.getAttribute("bumptype");b?"heightfield"===b.toLowerCase()?this.bump=(new I).parse(c):
"normalmap"===b.toLowerCase()?this.normal=(new I).parse(c):(console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+b+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'"),this.bump=(new I).parse(c)):(console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'"),this.bump=(new I).parse(c));break;case "shininess":case "reflectivity":case "index_of_refraction":case "transparency":b=c.querySelectorAll("float"),
0<b.length&&(this[c.nodeName]=parseFloat(b[0].textContent))}}this.create();return this};Aa.prototype.create=function(){var a={},d=!1;if(void 0!==this.transparency&&void 0!==this.transparent){var c=(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency;0<c&&(d=!0,a.transparent=!0,a.opacity=1-c)}var c={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"},b;for(b in this)switch(b){case "ambient":case "emission":case "diffuse":case "specular":case "bump":case "normal":var e=
this[b];if(e instanceof I)if(e.isTexture()){var f=this.effect.sampler[e.texture];if(void 0!==f&&void 0!==f.source&&(f=this.effect.surface[f.source],void 0!==f&&(f=fa[f.init_from]))){var f=Ea+f.init_from,g;g=THREE.Loader.Handlers.get(f);null!==g?g=g.load(f):(g=new THREE.Texture,Va(g,f));g.wrapS=e.texOpts.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;g.wrapT=e.texOpts.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;g.offset.x=e.texOpts.offsetU;g.offset.y=e.texOpts.offsetV;g.repeat.x=e.texOpts.repeatU;
g.repeat.y=e.texOpts.repeatV;a[c[b]]=g;"emission"===b&&(a.emissive=16777215)}}else"diffuse"!==b&&d||("emission"===b?a.emissive=e.color.getHex():a[b]=e.color.getHex());break;case "shininess":a[b]=this[b];break;case "reflectivity":a[b]=this[b];0<a[b]&&(a.envMap=D.defaultEnvMap);a.combine=THREE.MixOperation;break;case "index_of_refraction":a.refractionRatio=this[b],1!==this[b]&&(a.envMap=D.defaultEnvMap)}a.shading=Ua;a.side=this.effect.doubleSided?THREE.DoubleSide:THREE.FrontSide;void 0!==a.diffuse&&
(a.color=a.diffuse,delete a.diffuse);switch(this.type){case "constant":void 0!=a.emissive&&(a.color=a.emissive);this.material=new THREE.MeshBasicMaterial(a);break;case "phong":case "blinn":this.material=new THREE.MeshPhongMaterial(a);break;default:this.material=new THREE.MeshLambertMaterial(a)}return this.material};Ka.prototype.parse=function(a){for(var d=0;d<a.childNodes.length;d++){var c=a.childNodes[d];if(1==c.nodeType)switch(c.nodeName){case "init_from":this.init_from=c.textContent;break;case "format":this.format=
c.textContent;break;default:console.log("unhandled Surface prop: "+c.nodeName)}}return this};La.prototype.parse=function(a){for(var d=0;d<a.childNodes.length;d++){var c=a.childNodes[d];if(1==c.nodeType)switch(c.nodeName){case "source":this.source=c.textContent;break;case "minfilter":this.minfilter=c.textContent;break;case "magfilter":this.magfilter=c.textContent;break;case "mipfilter":this.mipfilter=c.textContent;break;case "wrap_s":this.wrap_s=c.textContent;break;case "wrap_t":this.wrap_t=c.textContent;
break;default:console.log("unhandled Sampler2D prop: "+c.nodeName)}}return this};M.prototype.create=function(){if(null===this.shader)return null};M.prototype.parse=function(a){this.id=a.getAttribute("id");this.name=a.getAttribute("name");Sa(this,a);this.shader=null;for(var d=0;d<a.childNodes.length;d++){var c=a.childNodes[d];if(1==c.nodeType)switch(c.nodeName){case "profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(c))}}return this};M.prototype.parseNewparam=function(a){for(var d=a.getAttribute("sid"),
c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if(1==b.nodeType)switch(b.nodeName){case "surface":this.surface[d]=(new Ka(this)).parse(b);break;case "sampler2D":this.sampler[d]=(new La(this)).parse(b);break;case "extra":break;default:console.log(b.nodeName)}}};M.prototype.parseProfileCOMMON=function(a){for(var d,c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if(1==b.nodeType)switch(b.nodeName){case "profile_COMMON":this.parseProfileCOMMON(b);break;case "technique":d=b;break;case "newparam":this.parseNewparam(b);
break;case "image":b=(new K).parse(b);fa[b.id]=b;break;case "extra":break;default:console.log(b.nodeName)}}return d};M.prototype.parseTechnique=function(a){for(var d=0;d<a.childNodes.length;d++){var c=a.childNodes[d];if(1==c.nodeType)switch(c.nodeName){case "constant":case "lambert":case "blinn":case "phong":this.shader=(new Aa(c.nodeName,this)).parse(c);break;case "extra":this.parseExtra(c)}}};M.prototype.parseExtra=function(a){for(var d=0;d<a.childNodes.length;d++){var c=a.childNodes[d];if(1==c.nodeType)switch(c.nodeName){case "technique":this.parseExtraTechnique(c)}}};
M.prototype.parseExtraTechnique=function(a){for(var d=0;d<a.childNodes.length;d++){var c=a.childNodes[d];if(1==c.nodeType)switch(c.nodeName){case "bump":this.shader.parse(a)}}};Ma.prototype.parse=function(a){this.url=a.getAttribute("url").replace(/^#/,"");return this};ta.prototype.parse=function(a){this.id=a.getAttribute("id");this.name=a.getAttribute("name");this.source={};for(var d=0;d<a.childNodes.length;d++){var c=a.childNodes[d];if(1==c.nodeType)switch(c.nodeName){case "animation":var c=(new ta).parse(c),
b;for(b in c.source)this.source[b]=c.source[b];for(var e=0;e<c.channel.length;e++)this.channel.push(c.channel[e]),this.sampler.push(c.sampler[e]);break;case "source":b=(new W).parse(c);this.source[b.id]=b;break;case "sampler":this.sampler.push((new la(this)).parse(c));break;case "channel":this.channel.push((new Na(this)).parse(c))}}return this};Na.prototype.parse=function(a){this.source=a.getAttribute("source").replace(/^#/,"");this.target=a.getAttribute("target");var d=this.target.split("/");d.shift();
a=d.shift();var c=0<=a.indexOf("."),b=0<=a.indexOf("(");if(c)d=a.split("."),this.sid=d.shift(),this.member=d.shift();else if(b){d=a.split("(");this.sid=d.shift();for(var e=0;e<d.length;e++)d[e]=parseInt(d[e].replace(/\)/,""));this.arrIndices=d}else this.sid=a;this.fullSid=a;this.dotSyntax=c;this.arrSyntax=b;return this};la.prototype.parse=function(a){this.id=a.getAttribute("id");this.inputs=[];for(var d=0;d<a.childNodes.length;d++){var c=a.childNodes[d];if(1==c.nodeType)switch(c.nodeName){case "input":this.inputs.push((new R).parse(c))}}return this};
la.prototype.create=function(){for(var a=0;a<this.inputs.length;a++){var d=this.inputs[a],c=this.animation.source[d.source];switch(d.semantic){case "INPUT":this.input=c.read();break;case "OUTPUT":this.output=c.read();this.strideOut=c.accessor.stride;break;case "INTERPOLATION":this.interpolation=c.read();break;case "IN_TANGENT":break;case "OUT_TANGENT":break;default:console.log(d.semantic)}}this.duration=this.endTime=this.startTime=0;if(this.input.length){this.startTime=1E8;this.endTime=-1E8;for(a=
0;a<this.input.length;a++)this.startTime=Math.min(this.startTime,this.input[a]),this.endTime=Math.max(this.endTime,this.input[a]);this.duration=this.endTime-this.startTime}};la.prototype.getData=function(a,d,c){var b;if("matrix"===a&&16===this.strideOut)b=this.output[d];else if(1<this.strideOut){b=[];d*=this.strideOut;for(c=0;c<this.strideOut;++c)b[c]=this.output[d+c];if(3===this.strideOut)switch(a){case "rotate":case "translate":E(b,-1);break;case "scale":E(b,1)}else 4===this.strideOut&&"matrix"===
a&&E(b,-1)}else if(b=this.output[d],c&&"translate"===a){a=b;if(!0===D.convertUpAxis&&Z!==D.upAxis)switch(c){case "X":a="XtoY"===G?-1*a:a;break;case "Y":a="YtoZ"===G||"YtoX"===G?-1*a:a;break;case "Z":a="ZtoY"===G?-1*a:a}b=a}return b};X.prototype.addTarget=function(a,d,c,b){this.targets.push({sid:a,member:c,transform:d,data:b})};X.prototype.apply=function(a){for(var d=0;d<this.targets.length;++d){var c=this.targets[d];a&&c.sid!==a||c.transform.update(c.data,c.member)}};X.prototype.getTarget=function(a){for(var d=
0;d<this.targets.length;++d)if(this.targets[d].sid===a)return this.targets[d];return null};X.prototype.hasTarget=function(a){for(var d=0;d<this.targets.length;++d)if(this.targets[d].sid===a)return!0;return!1};X.prototype.interpolate=function(a,d){for(var c=0,b=this.targets.length;c<b;c++){var e=this.targets[c],f=a.getTarget(e.sid);if("matrix"!==e.transform.type&&f){var g=(d-this.time)/(a.time-this.time),h=f.data,k=e.data;0>g&&(g=0);1<g&&(g=1);if(k.length)for(var f=[],l=0;l<k.length;++l)f[l]=k[l]+
(h[l]-k[l])*g;else f=k+(h-k)*g}else f=e.data;e.transform.update(f,e.member)}};ra.prototype.parse=function(a){this.id=a.getAttribute("id");this.name=a.getAttribute("name");for(var d=0;d<a.childNodes.length;d++){var c=a.childNodes[d];if(1==c.nodeType)switch(c.nodeName){case "optics":this.parseOptics(c)}}return this};ra.prototype.parseOptics=function(a){for(var d=0;d<a.childNodes.length;d++)if("technique_common"===a.childNodes[d].nodeName)for(var c=a.childNodes[d],b=0;b<c.childNodes.length;b++)if(this.technique=
c.childNodes[b].nodeName,"perspective"===this.technique)for(var e=c.childNodes[b],f=0;f<e.childNodes.length;f++){var g=e.childNodes[f];switch(g.nodeName){case "yfov":this.yfov=g.textContent;break;case "xfov":this.xfov=g.textContent;break;case "znear":this.znear=g.textContent;break;case "zfar":this.zfar=g.textContent;break;case "aspect_ratio":this.aspect_ratio=g.textContent}}else if("orthographic"===this.technique)for(e=c.childNodes[b],f=0;f<e.childNodes.length;f++)switch(g=e.childNodes[f],g.nodeName){case "xmag":this.xmag=
g.textContent;break;case "ymag":this.ymag=g.textContent;break;case "znear":this.znear=g.textContent;break;case "zfar":this.zfar=g.textContent;break;case "aspect_ratio":this.aspect_ratio=g.textContent}return this};Oa.prototype.parse=function(a){this.url=a.getAttribute("url").replace(/^#/,"");return this};ga.prototype.parse=function(a){this.id=a.getAttribute("id");this.name=a.getAttribute("name");for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case "technique_common":this.parseCommon(c);
break;case "technique":this.parseTechnique(c)}}return this};ga.prototype.parseCommon=function(a){for(var b=0;b<a.childNodes.length;b++)switch(a.childNodes[b].nodeName){case "directional":case "point":case "spot":case "ambient":this.technique=a.childNodes[b].nodeName;for(var c=a.childNodes[b],e=0;e<c.childNodes.length;e++){var f=c.childNodes[e];switch(f.nodeName){case "color":f=Y(f.textContent);this.color=new THREE.Color(0);this.color.setRGB(f[0],f[1],f[2]);this.color.a=f[3];break;case "falloff_angle":this.falloff_angle=
parseFloat(f.textContent);break;case "quadratic_attenuation":this.distance=(f=parseFloat(f.textContent))?Math.sqrt(1/f):0}}}return this};ga.prototype.parseTechnique=function(a){this.profile=a.getAttribute("profile");for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];switch(c.nodeName){case "intensity":this.intensity=parseFloat(c.textContent)}}return this};Pa.prototype.parse=function(a){this.url=a.getAttribute("url").replace(/^#/,"");return this};wa.prototype.parse=function(a){this.id=a.getAttribute("id");
this.name=a.getAttribute("name");this.joints=[];this.links=[];for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case "technique_common":this.parseCommon(c)}}return this};wa.prototype.parseCommon=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(a.childNodes[b].nodeName){case "joint":this.joints.push((new Qa).parse(c));break;case "link":this.links.push((new Ba).parse(c))}}return this};Qa.prototype.parse=function(a){this.sid=
a.getAttribute("sid");this.name=a.getAttribute("name");this.axis=new THREE.Vector3;this.limits={min:0,max:0};this.type="";this["static"]=!1;this.middlePosition=this.zeroPosition=0;var b=a.querySelector("axis"),b=Y(b.textContent);this.axis=na(b,0);var b=a.querySelector("limits min")?parseFloat(a.querySelector("limits min").textContent):-360,c=a.querySelector("limits max")?parseFloat(a.querySelector("limits max").textContent):360;this.limits={min:b,max:c};b=["prismatic","revolute"];for(c=0;c<b.length;c++){var e=
b[c];a.querySelector(e)&&(this.type=e)}this.limits.min>=this.limits.max&&(this["static"]=!0);this.middlePosition=(this.limits.min+this.limits.max)/2;return this};Ba.prototype.parse=function(a){this.sid=a.getAttribute("sid");this.name=a.getAttribute("name");this.transforms=[];this.attachments=[];for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case "attachment_full":this.attachments.push((new Ra).parse(c));break;case "rotate":case "translate":case "matrix":this.transforms.push((new u).parse(c))}}return this};
Ra.prototype.parse=function(a){this.joint=a.getAttribute("joint").split("/").pop();this.links=[];for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case "link":this.links.push((new Ba).parse(c));break;case "rotate":case "translate":case "matrix":this.transforms.push((new u).parse(c))}}return this};return{load:function(a,d,c,e){var f=0;if(document.implementation&&document.implementation.createDocument){var g=new XMLHttpRequest;g.onreadystatechange=function(){4===
g.readyState?0===g.status||200===g.status?g.response?(Da=d,b(g.response,void 0,a)):e?e({type:"error",url:a}):console.error("ColladaLoader: Empty or non-existing file ("+a+")"):e?e({type:"error",url:a}):console.error("ColladaLoader: Couldn't load \""+a+'" ('+g.status+")"):3===g.readyState&&c&&(0===f&&(f=g.getResponseHeader("Content-Length")),c({total:f,loaded:g.responseText.length}))};g.open("GET",a,!0);g.send(null)}else alert("Don't know how to parse XML!")},parse:b,setPreferredShading:function(a){Ua=
a},applySkin:p,geometries:N,options:D}};var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var b=document.createElement("canvas");return!(!window.WebGLRenderingContext||!b.getContext("webgl")&&!b.getContext("experimental-webgl"))}catch(f){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var b=document.createElement("div");b.id="webgl-error-message";b.style.fontFamily="monospace";b.style.fontSize="13px";b.style.fontWeight="normal";
b.style.textAlign="center";b.style.background="#fff";b.style.color="#000";b.style.padding="1.5em";b.style.width="400px";b.style.margin="5em auto 0";this.webgl||(b.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.');
return b},addGetWebGLMessage:function(b){var f,e;b=b||{};f=void 0!==b.parent?b.parent:document.body;b=void 0!==b.id?b.id:"oldie";e=Detector.getWebGLErrorMessage();e.id=b;f.appendChild(e)}};"object"===typeof module&&(module.exports=Detector);window.ThrowingDiceAnimation=ThrowingDiceAnimation;function ThrowingDiceAnimation(b){Detector.webgl||Detector.addGetWebGLMessage();this.parent=b.parent;this.objectDesiredSides=[{name:"Cube_000",currentSide:0,desiredSide:0},{name:"Cube_001",currentSide:0,desiredSide:0}];this.loopAnimation=!1;this.sidesRotation={1:[0,Math.PI/2,0],2:[-Math.PI/2,0,0],3:[0,0,0],4:[Math.PI,0,0],5:[Math.PI/2,0,0],6:[0,-Math.PI/2,0]};this.lastTimestamp=0}
ThrowingDiceAnimation.prototype.play=function(b,f){return new Promise(function(e,g){this.animationResolve=e;this.progress=this.lastTimestamp=0;this.objectDesiredSides[0].desiredSide=parseInt(b);this.objectDesiredSides[1].desiredSide=parseInt(f);this.objectDesiredSides.forEach(function(b){this.scene.traverse(function(e){e.colladaId&&-1!==e.colladaId.indexOf(b.name)&&this.rotateCubeObject(e,b)}.bind(this))},this);this.start();this.animate(this.lastTimestamp)}.bind(this))};
ThrowingDiceAnimation.prototype.start=function(){for(var b=0;b<this.kfAnimationsLength;++b){for(var f=this.kfAnimations[b],e=0,g=f.hierarchy.length;e<g;e++){var h=f.data.hierarchy[e].sids,r=f.hierarchy[e];if(f.data.hierarchy[e].keys.length&&h){for(var p=0;p<h.length;p++){var ea=h[p],B=f.getNextKeyWith(ea,e,0);B&&B.apply(ea)}r.matrixAutoUpdate=!1;f.data.hierarchy[e].node.updateMatrix();r.matrixWorldNeedsUpdate=!0}}f.loop=this.loopAnimation;f.play()}};
ThrowingDiceAnimation.prototype.animate=function(b){this.lastTimestamp=this.lastTimestamp?this.lastTimestamp:b;var f=.0015*(b-this.lastTimestamp);if(0<=this.progress&&this.progress<this.animationTimeSeconds)for(var e=0;e<this.kfAnimationsLength;++e)this.kfAnimations[e].update(f);else if(this.progress>=this.animationTimeSeconds){for(e=0;e<this.kfAnimationsLength;++e)this.kfAnimations[e].stop();this.progress=0;this.animationResolve&&this.animationResolve();return}this.progress+=f;this.lastTimestamp=
b;this.renderer.render(this.scene,this.camera);requestAnimationFrame(this.animate.bind(this))};
ThrowingDiceAnimation.prototype.loadScene=function(b){this.sceneUrl=b||"/scene/camera-above2.dae";return new Promise(function(b,e){this.animations=this.model=this.renderer=this.camera=this.scene=this.stats=null;this.kfAnimations=[];this.progress=this.lastTimestamp=this.kfAnimationsLength=0;loader=new THREE.ColladaLoader;loader.options.upAxis="Z";loader.load(this.sceneUrl,function(e){this.model=e.scene;this.animations=e.animations;this.kfAnimationsLength=this.animations.length;this.model.scale.x=this.model.scale.y=
this.model.scale.z=1;this.initScene();b()}.bind(this))}.bind(this))};
ThrowingDiceAnimation.prototype.initScene=function(){this.scene=new THREE.Scene;var b=this.model.getObjectByName("Camera");this.camera=new THREE.PerspectiveCamera(b.children[0].fov,this.parent.offsetWidth/this.parent.offsetHeight,.01,1E3);this.camera.matrix=b.matrix;this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale);this.model.children=this.model.children.filter(function(b){return"Camera"!=b.colladaId});for(b=0;b<this.kfAnimationsLength;++b){var f=new THREE.KeyFrameAnimation(this.animations[b]);
f.timeScale=1;this.kfAnimations.push(f)}for(b=this.animationTimeSeconds=0;b<this.kfAnimationsLength;++b)this.animationTimeSeconds=Math.max(this.animationTimeSeconds,this.kfAnimations[b].data.length);this.scene.add(this.model);this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0});this.renderer.setPixelRatio(window.devicePixelRatio);this.renderer.setSize(this.parent.offsetWidth,this.parent.offsetHeight);this.parent.appendChild(this.renderer.domElement);b=function(){this.camera.aspect=this.parent.offsetWidth/
this.parent.offsetHeight;this.camera.updateProjectionMatrix();this.renderer.setSize(this.parent.offsetWidth,this.parent.offsetHeight)}.bind(this);window.addEventListener("resize",b,!1)};
ThrowingDiceAnimation.prototype.rotateCubeObject=function(b,f){var e=f.currentSide,g=f.desiredSide;e||(e=this.getCurrentSide(b));if(g){var e=this.getSideRotation(e),h=this.getSideRotation(g);b.children[0].rotateX(-e[0]);b.children[0].rotateY(-e[1]);b.children[0].rotateZ(-e[2]);b.children[0].rotateX(h[0]);b.children[0].rotateY(h[1]);b.children[0].rotateZ(h[2]);f.currentSide=g}};
ThrowingDiceAnimation.prototype.getCurrentSide=function(b){var f=0;b=b.colladaId;return-1===b.indexOf("endSide")?f:f=b.substr(b.indexOf("endSide")+7,1)};ThrowingDiceAnimation.prototype.getSideRotation=function(b){return this.sidesRotation[b]};